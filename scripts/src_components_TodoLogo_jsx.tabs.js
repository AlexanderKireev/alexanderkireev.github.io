"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunkcard"] = self["webpackChunkcard"] || []).push([["src_components_TodoLogo_jsx"],{

/***/ "./src/components/TodoLogo.jsx":
/*!*************************************!*\
  !*** ./src/components/TodoLogo.jsx ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"./node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _contexts_dataContext_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../contexts/dataContext.js */ \"./src/contexts/dataContext.js\");\n/* harmony import */ var _methods_getFetchData_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../methods/getFetchData.js */ \"./src/methods/getFetchData.js\");\n/* harmony import */ var _methods_getArticleContent_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../methods/getArticleContent.js */ \"./src/methods/getArticleContent.js\");\n/* harmony import */ var _constants_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../constants.js */ \"./src/constants.js\");\n/* harmony import */ var _routes_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../routes.js */ \"./src/routes.js\");\n\n\n\n\n\n\nconst TodoLogo = ({\n  todo\n}) => {\n  const {\n    imgLinks,\n    setBoxesCn,\n    scrollToTop,\n    setCurrentId,\n    setFullText,\n    setImgLinks,\n    setPreviewContentCn,\n    setZIndex,\n    // zIndex,\n    setVisitedIds\n  } = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(_contexts_dataContext_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"]);\n  const [resource, setResource] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n  const [data, setData] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n  const [imgSrc, setImgSrc] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(null);\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    if (todo.feed !== \"rbc\" && !imgLinks[todo.id]) {\n      const _resource = (0,_methods_getFetchData_js__WEBPACK_IMPORTED_MODULE_2__.wrapPromise)((0,_methods_getFetchData_js__WEBPACK_IMPORTED_MODULE_2__.fetcher)(_routes_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"].linkPath(todo.link), todo.fetchDelay));\n      setResource(_resource);\n    }\n  }, []);\n  if (!imgSrc && imgLinks[todo.id]) {\n    setImgSrc(imgLinks[todo.id]);\n  } else {\n    const promiseResolveResponse = todo.feed !== \"rbc\" ? resource?.read() : \"Lorem insup\";\n    if (data !== promiseResolveResponse) {\n      setData(promiseResolveResponse);\n    }\n  }\n  (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {\n    if (data) {\n      const {\n        resultImgLink,\n        articleContent\n      } = (0,_methods_getArticleContent_js__WEBPACK_IMPORTED_MODULE_3__[\"default\"])(todo, data);\n      setImgSrc(resultImgLink);\n      setImgLinks(prevState => ({\n        ...prevState,\n        [todo.id]: resultImgLink\n      }));\n      setFullText(prevState => ({\n        ...prevState,\n        [todo.id]: articleContent\n      }));\n    }\n  }, [data]);\n  const memoizedTodoLogo = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {\n    console.log(\"logo rerendered\"); /// не забыть удалить\n\n    const changeTodo = () => {\n      if (!history.state && screen.orientation.type === \"portrait-primary\") {\n        window.history.pushState({\n          handleState: true\n        }, null, \"./\");\n        setBoxesCn(\"boxes no-scroll\");\n      }\n      setZIndex(1);\n      setVisitedIds(prevState => [todo.id, ...prevState]);\n      setCurrentId(todo.id);\n      scrollToTop();\n      setPreviewContentCn(\"menu-content show\");\n      setTimeout(() => {\n        setPreviewContentCn(\"menu-content\"); /////// надо переименовать в preview-content\n      }, _constants_js__WEBPACK_IMPORTED_MODULE_4__.previewTransitionDuration);\n    };\n    return (\n      /*#__PURE__*/\n      // зачем img-include ?????\n      react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n        className: \"todo-logo img-include\"\n      }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"img\", {\n        alt: \"img\",\n        className: \"logo\",\n        onClick: changeTodo,\n        src: imgSrc\n        // loading=\"lazy\"\n      }))\n    );\n  }, [imgSrc]);\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, memoizedTodoLogo);\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (TodoLogo);\n\n//# sourceURL=webpack://card/./src/components/TodoLogo.jsx?");

/***/ }),

/***/ "./src/methods/getArticleContent.js":
/*!******************************************!*\
  !*** ./src/methods/getArticleContent.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"./node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _routes__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../routes */ \"./src/routes.js\");\n\n\nconst feeds = {\n  rbc: \"Читать новость на сайте РБК.ru\",\n  mail: \"Читать новость на сайте Mail.ru\",\n  bloknot: \"Читать новость на сайте Блокнот.ru\"\n};\nconst getBloknotComponents = (title, articleBody, link) => {\n  const bodyWithoutBags = articleBody.replaceAll(/<\\/b>\\s*?<b>/g, \"\").replaceAll(/<\\/strong>\\s*?<strong>/g, \"\").replaceAll(/<\\/i>\\s*?<i>/g, \"\").replaceAll(/<\\/italic>\\s*?<italic>/g, \"\").replaceAll(/<script.[\\s\\S]*?<\\/script>/g, \"\").replaceAll(/<a\\s*?>/g, \"\").replaceAll(\"</a>\", \"\");\n  const [firstString, ...lastStrings] = bodyWithoutBags.split(\"</\");\n  const body = lastStrings.join(\"</\").replaceAll(\"<br>\", \"</p>\").split(\"</p>\");\n  const strings = [];\n  body.forEach(str => {\n    const imgs = [];\n    const imgCount = (str.match(/<img/g) || []).length;\n    let prevBegin = 0;\n    for (let i = 0; i < imgCount; i += 1) {\n      const begin = str.indexOf(\"<img\", prevBegin);\n      const end = str.indexOf(\">\", begin);\n      prevBegin = end;\n      const img = str.slice(begin, end) + \">\";\n      const srcIndex = img.indexOf(\"src\");\n      const imgSrc = _routes__WEBPACK_IMPORTED_MODULE_1__.bloknotRostovPath + img.slice(srcIndex + 6, img.indexOf('\"', srcIndex + 6));\n      imgs.push(imgSrc);\n    }\n    imgs.forEach(img => {\n      strings.push(\" \");\n      strings.push(img);\n    });\n    const pWithoutTags = str.replaceAll(/<.*?>/g, \"\");\n    const p = pWithoutTags.slice(pWithoutTags.indexOf(\">\") + 1).replaceAll(\"\\r\", \"\").replaceAll(\"\\n\", \"\").replaceAll(\"\\t\", \"\").replaceAll(\"&nbsp;\", \" \").trim();\n    if (p !== \"\") {\n      strings.push(p);\n    }\n  });\n  const description = firstString.replaceAll(/<.*?>/g, \"\").replaceAll(\"\\r\", \"\").replaceAll(\"\\n\", \"\").replaceAll(\"\\t\", \"\").replaceAll(\"&nbsp;\", \" \").trim();\n  const result = [/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h2\", {\n    key: 0\n  }, `${title}`), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h3\", {\n    key: 1\n  }, `${description}`)];\n  strings.forEach((str, i) => {\n    if (str[0] === \"h\" && str[1] === \"t\") {\n      result.push(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"img\", {\n        key: i + 2,\n        className: \"menu-todo-logo\",\n        src: `${str}`,\n        alt: \"img\"\n      }));\n    } else {\n      result.push(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", {\n        key: i + 2\n      }, `${str}`));\n    }\n  });\n  result.push(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", {\n    key: strings.length + 2\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"a\", {\n    href: link,\n    target: \"_blank\",\n    rel: \"noreferrer\"\n  }, feeds.bloknot)));\n  for (let i = 1; i <= 3; i += 1) {\n    result.push(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"br\", {\n      key: strings.length + i + 2\n    }));\n  }\n  return result;\n};\nconst getRbcAndMailComponents = (headline, articleBody, description, link, feed) => {\n  const regexp = /(?<!\\sп)(?<!\\sст)(?<!\\sч)(?<!\\.\\s*[А-Я])(?<!\\sг)(?<!\\sим)(?<!ул)\\.\\s*[А-Я«](?!\\.)/g;\n  const lines = articleBody.split(regexp);\n  const splitFragments = articleBody.match(regexp);\n  const paragraphs = [];\n  lines.forEach((line, i) => {\n    if (i === 0) {\n      paragraphs.push(line + \".\");\n    } else if (i === lines.length - 1) {\n      paragraphs.push(splitFragments[i - 1].slice(-1) + line);\n    } else {\n      paragraphs.push(splitFragments[i - 1].slice(-1) + line + \".\");\n    }\n  });\n  const result = [/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h2\", {\n    key: 0\n  }, `${headline}`), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h3\", {\n    key: 1\n  }, `${description}`)];\n  paragraphs.forEach((paragraph, i) => {\n    result.push(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", {\n      key: i + 2\n    }, `${paragraph}`));\n  });\n  result.push(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", {\n    key: paragraphs.length + 2\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"a\", {\n    href: link,\n    target: \"_blank\",\n    rel: \"noreferrer\"\n  }, feeds[feed])));\n  for (let i = 1; i <= 3; i += 1) {\n    result.push(/*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"br\", {\n      key: paragraphs.length + i + 2\n    }));\n  }\n  return result;\n};\nconst searchFullText = (content, searchText, finalText, alternativeFinalText) => {\n  const indexOfContent = content.indexOf(searchText);\n  if (indexOfContent < 0) {\n    return \"Не удалось загрузить новость\";\n  }\n  const indexOfBegin = finalText === '\"' ? content.indexOf('\"', content.indexOf('\"', indexOfContent) + 1) + 1 : content.indexOf(searchText, indexOfContent + 1) + searchText.length + 2;\n  const indexOfEnd = content.indexOf(finalText) < 0 ? content.indexOf(alternativeFinalText) : content.indexOf(finalText, indexOfBegin);\n  return content.slice(indexOfBegin, indexOfEnd);\n};\nconst searchImgLink = (content, searchText, alternativeSearchText) => {\n  const indexOfText = content.indexOf(searchText) < 0 ? content.indexOf(alternativeSearchText) : content.indexOf(searchText);\n  if (indexOfText < 0) {\n    return \"./src/assets/noimage.jpg\";\n  }\n  const firstQuoteIndex = content.indexOf('\"', content.indexOf('\"', indexOfText) + 1) + 1;\n  const lastQuoteIndex = content.indexOf('\"', firstQuoteIndex);\n  const result = content.slice(firstQuoteIndex, lastQuoteIndex);\n  const imgLink = alternativeSearchText === \"https:\" ? alternativeSearchText + result : result;\n  if (result[result.length - 2 - 2] === \".\" || result[result.length - 2 - 2 - 1] === \".\") {\n    return imgLink;\n  } else {\n    const imgLinkChars = [];\n    let i = indexOfText - 2 - 1;\n    let quoteCounter = 0;\n    while (quoteCounter < 2) {\n      if (content.charAt(i) === '\"') {\n        quoteCounter += 1;\n      }\n      if (quoteCounter === 1 && content.charAt(i) !== '\"') {\n        imgLinkChars.unshift(content.charAt(i));\n      }\n      i -= 1;\n    }\n    return imgLinkChars.join(\"\");\n  }\n};\nconst getArticleContent = ({\n  feed,\n  title,\n  description,\n  fullText,\n  imgUrl,\n  link\n}, data) => {\n  let resultImgLink, articleContent, articleBody, headline;\n  switch (feed) {\n    case \"bloknot\":\n      resultImgLink = searchImgLink(data, \"detail_picture\", \"https:\");\n      articleBody = searchFullText(data, \"news-text\", \"Наш сайт в соцсетях\", \"Новости на Блoкнoт\");\n      articleContent = getBloknotComponents(title, articleBody, link);\n      break;\n    case \"mail\":\n      headline = searchFullText(data, \"headline\", '\"', null);\n      articleBody = searchFullText(data, \"articleBody\", '\"', null);\n      articleContent = getRbcAndMailComponents(headline, articleBody, description, link, feed);\n      resultImgLink = searchImgLink(data, \"yandex_recommendations_image\", \"yandex_recommendations_category\");\n      break;\n    case \"rbc\":\n      articleContent = getRbcAndMailComponents(title, fullText ? fullText : \"Новость удалена\", description, link, feed);\n      resultImgLink = imgUrl;\n      break;\n  }\n  return {\n    resultImgLink,\n    articleContent\n  };\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (getArticleContent);\n\n//# sourceURL=webpack://card/./src/methods/getArticleContent.js?");

/***/ })

}]);